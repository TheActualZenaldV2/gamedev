<!DOCTYPE html>
<html>
<head>
	<title>Create Your Own Maze</title>
</head>
<body>
    
<div id="options">
        <p id="choose" > Choose map size: </p>
        <form id="map-form">
            <input id="size" type="text" placeholder="Size (e.g. 10x10)" required>
            <button id="generate-map">Generate Map</button>
          </form>
          
        <div id="buttons">
		<button id="empty">Empty Space</button> 
		<button id="wall">Wall</button>
		<button id="finish">Finish</button>
		<button id="diamond">Diamond</button>
		<button id="fakeWall">Fake Wall</button>
		<button id="invisibleWall">Invisible Wall</button>
    <div id="advancedTools">
		<button id="zoomOutBlock">Zoom Out Block</button>
		<button id="zoomInBlock">Zoom In Block</button>
		<button id="jumpScare">Jump Scare</button>
        <input type="button" value="Close" onclick="document.getElementById('advancedTools').style.display = 'none'; document.getElementById('buttons').style.display = 'inline-block'; document.getElementById('advancedToolsButton').style.display = 'inline-block';">
        
        <input type="button" value="Reset" onclick="location.reload()">
    </div>
		<input type="button" value="Export Map" onclick="exportMap()">
        <input id="advancedToolsButton" type="button" value="Advanced Tools" onclick="document.getElementById('advancedTools').style.display = 'block'; this.style.display = 'none';">
	</div>

    <div class="map-container"> 
        <div id="map"></div>
    </div>
</div>
</body>

<style>
    /* import poppins font */
@import url('https://fonts.googleapis.com/css?family=Poppins:400,500,600,700&display=swap');




#map {
    margin-top: 20px;
    margin: 0 auto;
    
    display: flex;
    flex-wrap: wrap;
    
   
    background-color: white;
    user-select: none;
    
    
    box-shadow: 10px 10px 100px 10px rgba(0,0,0,0.85);

}

#map > div {
  box-sizing: border-box;
  width: 40px;
  height: 40px;
  border: 1px solid black;
}






#buttons {
	margin-top: 20px;
}

#buttons button {
	margin-right: 10px;
}

body {
    text-align: center;
    background-color: #eee;
    font-family: 'Poppins', sans-serif;
    
    padding: 0;
    overflow: scroll;
}

#advancedTools {
    display: none;
}
input {
    margin-top: 10px;
    margin-bottom: 10px;
    padding: 5px;
    border-radius: 5px;
    border: 1px solid black;
    background-color: white;
    cursor: pointer;
    font-family: 'Poppins', sans-serif;
    font-size: 16px;
    transition: 0.2s;
}
button {
    margin-top: 10px;
    margin-bottom: 10px;
    padding: 5px;
    border-radius: 5px;
    border: 1px solid black;
    background-color: white;
    cursor: pointer;
    font-family: 'Poppins', sans-serif;
    font-size: 16px;
    transition: 0.2s;
}


</style> 

<script>
var width;
var height;
var map = [];
var previusButton;

var mapForm = document.getElementById("map-form");
document.getElementById("map").style.display = "none";

mapForm.addEventListener("submit", function(event) {



    event.preventDefault();
        document.getElementById("choose").innerHTML = "Choose a tile:"
        document.getElementById("buttons").style.display = "block";
        document.getElementById("map").style.display = "none";
        document.getElementById("generate-map").style.display = "none";
        document.getElementById("size").style.display = "none";
        map = []; // Reset the map array to an empty array
    var size = document.getElementById("size").value;
         width = parseInt(size.split("x")[0]);
        height = parseInt(size.split("x")[1]);
        var mapDiv = document.getElementById("map");
       

        mapDiv.style.width = width * 30 + "px";
        mapDiv.style.height = height * 30 + "px";

        mapDiv.innerHTML = "";
        for (var i = 0; i < height; i++) {
            map.push([]);
            for (var j = 0; j < width; j++) {
                var cell = document.createElement("div");
                cell.className = "cell";
                cell.style.width = 100 / width + "%";
                cell.style.height = 100 / height + "%";
                cell.addEventListener("click", changeCell);
                mapDiv.appendChild(cell);
                map[i].push(0);
            }
        }

        

  
});

const buttonsHolder = document.getElementById("buttons");

function createMapContainer() {
  // Remove the event listener to prevent multiple containers from being created
  buttonsHolder.removeEventListener("click", createMapContainer);
  
  //create a div enclosing the map and give it a thick border
  var mapContainer = document.createElement("div");
  mapContainer.className = "map-container";
  mapContainer.style.border = "10px solid black";
  mapContainer.style.borderRadius = "10px";
  mapContainer.style.width = width * 30 + "px";
  mapContainer.style.height = height * 30 + "px";
  mapContainer.style.margin = "0 auto";

  mapContainer.appendChild(mapDiv);
  document.body.appendChild(mapContainer);
  document.getElementById("map").style.display = "flex";

  document.getElementsByClassName("map-container")[0].style.display = "flex";
  document.getElementById("choose").innerHTML = "Click or drag to draw:"
}

buttonsHolder.addEventListener("click", createMapContainer);



document.getElementById("buttons").style.display = "none";


  

// Get the map div
var mapDiv = document.getElementById("map");

// Add cells to the map
for (var i = 0; i < height; i++) {
	for (var j = 0; j < width; j++) {
		var cell = document.createElement("div");
		cell.addEventListener("click", changeCell);
		mapDiv.appendChild(cell);
	}
}// Add event listener to the document for mousemove event
mapHolder = document.getElementById("map");
mapHolder.addEventListener("mousemove", function(event) {
  // Check if mouse button is pressed
  if (event.buttons === 1) {
    // Get the cell that the mouse is over
    var cell = event.target;
    // Change the cell's value
    changeCellValue(cell);
  }
});

// Change the cell's value when clicked or dragged
function changeCell(e) {
    // Prevent the default drag behavior
    e.preventDefault();

    // Determine the cell's position
    var x = Array.prototype.indexOf.call(mapDiv.children, this) % width;
    var y = Math.floor(Array.prototype.indexOf.call(mapDiv.children, this) / width);

    // Determine the cell's value based on the selected button
    var value;

    switch (selectedButton) {
        case "empty":
            value = 0;
            break;
        case "wall":
            value = 1;
            break;
        case "finish":
            value = 2;
            break;
        case "diamond":
            value = 3;
            break;
        case "fakeWall":
            value = 4;
            break;
        case "invisibleWall":
            value = 5;
            break;
        case "zoomOutBlock":
            value = 6;
            break;
        case "zoomInBlock":
            value = 7;
            break;
        case "jumpScare":
            value = 8;
            break;
    }

    // Update the map array and cell value
    map[y][x] = value;
    this.classList.remove(this.classList[0]);
    this.classList.add("value" + value);
    this.style.backgroundColor = selectedColor;

    // If the mouse button is down, continue to drag cells
    if (e.buttons === 1) {
        //if mouse coordinates are outside of the map, stop drawing, or if on border
        if (e.clientX < mapDiv.getBoundingClientRect().left || e.clientX > mapDiv.getBoundingClientRect().right || e.clientY < mapDiv.getBoundingClientRect().top || e.clientY > mapDiv.getBoundingClientRect().bottom) {
            return;
        }
        this.addEventListener("mousemove", changeCell);
    } else {
        this.removeEventListener("mousemove", changeCell);
    }
}

// Change the value of a cell
function changeCellValue(cell) {
  // Get the cell's x and y coordinates
  var x = Array.prototype.indexOf.call(mapDiv.children, cell) % width;
  var y = Math.floor(Array.prototype.indexOf.call(mapDiv.children, cell) / width);
  var value;
  switch (selectedButton) {
    case "empty":
      value = 0;
      previusButton = selectedButton;
      break;
    case "wall":
      value = 1;
      previusButton = selectedButton;
      break;
    case "finish":
      value = 2;
      previusButton = selectedButton;
      break;
    case "diamond":
      value = 3;
      previusButton = selectedButton;
      break;
    case "fakeWall":
      value = 4;
      previusButton = selectedButton;
      break;
    case "invisibleWall":
      value = 5;
      previusButton = selectedButton;
      break;
    case "zoomOutBlock":
      value = 6;
      previusButton = selectedButton;
      break;
    case "zoomInBlock":
      value = 7;
      previusButton = selectedButton;
      break;
    case "jumpScare":
      value = 8;
      previusButton = selectedButton;
      break;
  }
  map[y][x] = value;
  cell.classList.remove(cell.classList[0]);
  cell.classList.add("value" + value);
  // Change the selected tile's color
  cell.style.backgroundColor = selectedColor;

}


// Set the selected button
var selectedButton;
var selectedColor;
var buttons = document.getElementsByTagName("button");
for (var i = 0; i < buttons.length; i++) {
	buttons[i].addEventListener("click", function() {
		selectedButton = this.id;
        // Set the selected color based on the selected button
        switch (selectedButton) {
            case "empty":
                selectedColor = "white";
                break;
            case "wall":
                selectedColor = "gray";
                break;
            case "finish":
                selectedColor = "green";
                break;
            case "diamond":
                selectedColor = "blue";
                break;
            case "fakeWall":
                selectedColor = "orange";
                break;
            case "invisibleWall":
                selectedColor = "lightgray";
                break;
            case "zoomOutBlock":
                selectedColor = "yellow";
                break;
            case "zoomInBlock":
                selectedColor = "purple";
                break;
            case "jumpScare":
                selectedColor = "red";
                break;
        }
        // Update the button styles
        for (var j = 0; j < buttons.length; j++) {
            buttons[j].style.backgroundColor = "white";
            buttons[j].style.color = "black";
        }
        this.style.backgroundColor = selectedColor;
        this.style.color = "white";
        
	});
}

function exportMap() {
    selectedButton = previusButton;

exportArray = [];
for (var i = 0; i < height; i++) {
    var rowArray = [];
    for (var j = 0; j < width; j++) {
        if (map[i][j] === 0) {
            rowArray.push(0);
        } else {
            rowArray.push(map[i][j]);
        }
    }
    exportArray.push(rowArray);
}
console.log(JSON.stringify(exportArray).replace(/\],/g, "],\n"));
alert("Map exported to console and clipboard.");
//send it to user clipboard
var dummy = document.createElement("textarea");
document.body.appendChild(dummy);
dummy.value = JSON.stringify(exportArray).replace(/\],/g, "],\n");
dummy.select();
document.execCommand("copy");
document.body.removeChild(dummy);
exportArray = [];


}
















    </script> 


</html>
